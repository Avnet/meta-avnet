#include <dt-bindings/media/xilinx-vip.h>

&fmc_quad_fmc_multicam_control_fmc_multicam_iic {
    
    i2cswitch@70 {
        compatible = "nxp,pca9548";
        #address-cells = <1>;
        #size-cells = <0>;
        reg = <0x70>;
        reset-gpios = <&gpio 112 1>;

        i2c@0 {
            #address-cells = <1>;
            #size-cells = <0>;
            reg = <0>;

            /* Sensors */
            ar0231_0: sensor@11 {
                compatible = "ar0231";
                reg = <0x11>;
                #address-cells = <1>;
                #size-cells = <0>;

                port@0 {
                    reg = <0>;
                    sensor_out0: endpoint {
                        remote-endpoint = <&serdes_in0>;
                    };
                };
            };
            ar0231_1: sensor@12 {
                compatible = "ar0231";
                reg = <0x12>;
                #address-cells = <1>;
                #size-cells = <0>;

                port@0 {
                    reg = <0>;
                    sensor_out1: endpoint {
                        remote-endpoint = <&serdes_in1>;
                    };
                };
            };
            ar0231_2: sensor@13 {
                compatible = "ar0231";
                reg = <0x13>;
                #address-cells = <1>;
                #size-cells = <0>;

                port@0 {
                    reg = <0>;
                    sensor_out2: endpoint {
                        remote-endpoint = <&serdes_in2>;
                    };
                };
            };
            ar0231_3: sensor@14 {
                compatible = "ar0231";
                reg = <0x14>;
                #address-cells = <1>;
                #size-cells = <0>;

                port@0 {
                    reg = <0>;
                    sensor_out3: endpoint {
                        remote-endpoint = <&serdes_in3>;
                    };
                };
            };
            ar0231_4: sensor@10 {
                compatible = "ar0231-i2c";
                reg = <0x10>;
                #address-cells = <1>;
                #size-cells = <0>;
            };

            /* Serializer */
            max96705_serdes_0: serdes@40 {
                compatible = "max96705-serdes";
                reg = <0x40>;
            };
            max96705_serdes_1: serdes@41 {
                compatible = "max96705-serdes";
                reg = <0x41>;
            };
            max96705_serdes_2: serdes@42 {
                compatible = "max96705-serdes";
                reg = <0x42>;
            };
            max96705_serdes_3: serdes@43 {
                compatible = "max96705-serdes";
                reg = <0x43>;
            };
            max96705_serdes_4: serdes@44 {
                compatible = "max96705-serdes";
                reg = <0x44>;
            };
            max96705_serdes_5: serdes@45 {
                compatible = "max96705-serdes";
                reg = <0x45>;
            };

            /* Deserializer */
            max9286_serdes_0: serdes@48 {
                compatible = "max9286-serdes";
                reg = <0x48>;
                num-si-slots = <0x4>;
                num-mi-slots = <0x1>;
                cam-config = <0x6>;
                mipi-lanes = <0x4>;
                pixel-freq = <75>;
                sensor_0-supply = <&camvcc_0>;
                sensor_1-supply = <&camvcc_1>;
                sensor_2-supply = <&camvcc_2>;
                sensor_3-supply = <&camvcc_3>;
                enable-gpios = <&gpio 110 0>;

                serializer_adapter_default  = <&max96705_serdes_0>;
                serializer_adapter_brdcast  = <&max96705_serdes_5>;
                sensor_adapter_brdcast = <&ar0231_4>;

                ports {
                    #address-cells = <1>;
                    #size-cells = <0>;

                    port@0 {
                        reg = <0>;
                        enable = <1>;
                        video-format = <XVIP_VF_MONO_SENSOR>;
                        video-width = <8>;
                        cfa-pattern = "rggb";
                        serializer_adapter_link0 = <&max96705_serdes_1>;
                        sensor_adapter_0 = <&ar0231_0>;
                        serdes_in0: endpoint {
                            remote-endpoint = <&sensor_out0>;
                        };
                    };
                    port@1 {
                        reg = <1>;
                        enable = <1>;
                        video-format = <XVIP_VF_MONO_SENSOR>;
                        video-width = <8>;
                        cfa-pattern = "rggb";
                        serializer_adapter_link1 = <&max96705_serdes_2>;
                        sensor_adapter_1 = <&ar0231_1>;
                        serdes_in1: endpoint {
                            remote-endpoint = <&sensor_out1>;
                        };
                    };
                    port@2 {
                        reg = <2>;
                        enable = <1>;
                        video-format = <XVIP_VF_MONO_SENSOR>;
                        video-width = <8>;
                        cfa-pattern = "rggb";
                        serializer_adapter_link2 = <&max96705_serdes_3>;
                        sensor_adapter_2 = <&ar0231_2>;
                        serdes_in2: endpoint {
                            remote-endpoint = <&sensor_out2>;
                        };
                    };
                    port@3 {
                        reg = <3>;
                        enable = <1>;
                        video-format = <XVIP_VF_MONO_SENSOR>;
                        video-width = <8>;
                        cfa-pattern = "rggb";
                        serializer_adapter_link3 = <&max96705_serdes_4>;
                        sensor_adapter_3 = <&ar0231_3>;
                        serdes_in3: endpoint {
                            remote-endpoint = <&sensor_out3>;
                        };
                    };
                    port@4 {
                        reg = <4>;
                        enable = <1>;
                        video-format = <XVIP_VF_MONO_SENSOR>;
                        video-width = <8>;
                        cfa-pattern = "rggb";
                        serdes_out0: endpoint {
                            remote-endpoint = <&csiss_in>;
                        };
                    };
                };
            };
        };

        /* Serializer & Sensor power */
        i2c@2 {
            #address-cells = <1>;
            #size-cells = <0>;
            reg = <2>;

            poc1: poc@28 {
                compatible = "max20087";
                reg = <0x28>;
                /*interrupts = <3 27>;*/
                enable-gpios = <&gpio 108 0>;

                regulators {
                    camvcc_0: OUT1 {
                        regulator-name = "VOUT1";
                        regulator-min-microvolt = <1200000>;
                        regulator-max-microvolt = <1200000>;
                        regulator-min-microamp  = <600000>;
                        regulator-max-microamp  = <600000>;
                    };
                    camvcc_1: OUT2 {
                        regulator-name = "VOUT2";
                        regulator-min-microvolt = <1200000>;
                        regulator-max-microvolt = <1200000>;
                        regulator-min-microamp  = <600000>;
                        regulator-max-microamp  = <600000>;
                    };
                    camvcc_2: OUT3 {
                        regulator-name = "VOUT3";
                        regulator-min-microvolt = <1200000>;
                        regulator-max-microvolt = <1200000>;
                        regulator-min-microamp  = <600000>;
                        regulator-max-microamp  = <600000>;
                    };
                    camvcc_3: OUT4 {
                        regulator-name = "VOUT4";
                        regulator-min-microvolt = <1200000>;
                        regulator-max-microvolt = <1200000>;
                        regulator-min-microamp  = <600000>;
                        regulator-max-microamp  = <600000>;
                    };
                };
            };
        };
    };
};

&fmc_quad_mipi_csi2_rx_mipi_csi2_rx_subsystem_0 {
    
    xlnx,csi-pxl-format = "RAW8";

    ports {
        #address-cells = <1>;
        #size-cells = <0>;

        port@0 {
            reg = <0>;

            xlnx,video-format = <XVIP_VF_MONO_SENSOR>;
            xlnx,video-width = <8>;
            xlnx,cfa-pattern = "rggb";

            csiss_out: endpoint {
                remote-endpoint = <&switch_in0>;
            };
        };
        port@1 {
            reg = <1>;

            xlnx,video-format = <XVIP_VF_MONO_SENSOR>;
            xlnx,video-width = <8>;
            xlnx,cfa-pattern = "rggb";

            csiss_in: endpoint {
                data-lanes = <1 2 3 4>;
                remote-endpoint = <&serdes_out0>;
            };
        };
    };
};

&fmc_quad_mipi_csi2_rx_capture_pipeline_0_v_demosaic_0
{
    reset-gpios = <&gpio 85 1>;
    xlnx,max-height = <1080>;
    xlnx,max-width = <1920>;

    ports {
        #address-cells = <1>;
        #size-cells = <0>;

        port@0 {
            reg = <0>;

            xlnx,video-width = <8>;
            xlnx,cfa-pattern = "grbg";

            demosaic_0_in: endpoint {
                remote-endpoint = <&switch_out0>;
            };
        };

        port@1 {
            reg = <1>;

            xlnx,video-width = <8>;

            demosaic_0_out: endpoint {
                remote-endpoint = <&v_csc_0_in>;
            };
        };
    };
};
&fmc_quad_mipi_csi2_rx_capture_pipeline_1_v_demosaic_1
{
    reset-gpios = <&gpio 98 1>;
    xlnx,max-height = <1080>;
    xlnx,max-width = <1920>;

    ports {
        #address-cells = <1>;
        #size-cells = <0>;

        port@0 {
            reg = <0>;

            xlnx,video-width = <8>;
            xlnx,cfa-pattern = "grbg";

            demosaic_1_in: endpoint {
                remote-endpoint = <&switch_out1>;
            };
        };

        port@1 {
            reg = <1>;

            xlnx,video-width = <8>;

            demosaic_1_out: endpoint {
                remote-endpoint = <&v_csc_1_in>;
            };
        };
    };
};
&fmc_quad_mipi_csi2_rx_capture_pipeline_2_v_demosaic_2
{
    reset-gpios = <&gpio 101 1>;
    xlnx,max-height = <1080>;
    xlnx,max-width = <1920>;

    ports {
        #address-cells = <1>;
        #size-cells = <0>;

        port@0 {
            reg = <0>;

            xlnx,video-width = <8>;
            xlnx,cfa-pattern = "grbg";

            demosaic_2_in: endpoint {
                remote-endpoint = <&switch_out2>;
            };
        };

        port@1 {
            reg = <1>;

            xlnx,video-width = <8>;

            demosaic_2_out: endpoint {
                remote-endpoint = <&v_csc_2_in>;
            };
        };
    };
};
&fmc_quad_mipi_csi2_rx_capture_pipeline_3_v_demosaic_3
{
    reset-gpios = <&gpio 104 1>;
    xlnx,max-height = <1080>;
    xlnx,max-width = <1920>;

    ports {
        #address-cells = <1>;
        #size-cells = <0>;

        port@0 {
            reg = <0>;

            xlnx,video-width = <8>;
            xlnx,cfa-pattern = "grbg";

            demosaic_3_in: endpoint {
                remote-endpoint = <&switch_out3>;
            };
        };

        port@1 {
            reg = <1>;

            xlnx,video-width = <8>;

            demosaic_3_out: endpoint {
                remote-endpoint = <&v_csc_3_in>;
            };
        };
    };
};

&fmc_quad_mipi_csi2_rx_capture_pipeline_0_v_proc_ss_csc_0
{
    compatible = "xlnx,v-vpss-csc";
    reset-gpios = <&gpio 84 1>;
    ports {
        #address-cells = <1>;
        #size-cells = <0>;

        port@0 {
            reg = <0>;

            xlnx,video-format = <XVIP_VF_RBG>;
            xlnx,video-width = <8>;

            v_csc_0_in: endpoint {
                remote-endpoint = <&demosaic_0_out>;
            };
        };
        port@1 {
            reg = <1>;

            xlnx,video-format = <XVIP_VF_YUV_422>;
            xlnx,video-width = <8>;

            v_csc_0_out: endpoint {
                remote-endpoint = <&v_scaler_0_in>;
            };
        };
    };  
};
&fmc_quad_mipi_csi2_rx_capture_pipeline_1_v_proc_ss_csc_1
{
    compatible = "xlnx,v-vpss-csc";
    reset-gpios = <&gpio 92 1>;
    ports {
        #address-cells = <1>;
        #size-cells = <0>;

        port@0 {
            reg = <0>;

            xlnx,video-format = <XVIP_VF_RBG>;
            xlnx,video-width = <8>;

            v_csc_1_in: endpoint {
                remote-endpoint = <&demosaic_1_out>;
            };
        };
        port@1 {
            reg = <1>;

            xlnx,video-format = <XVIP_VF_YUV_422>;
            xlnx,video-width = <8>;

            v_csc_1_out: endpoint {
                remote-endpoint = <&v_scaler_1_in>;
            };
        };
    };  
};
&fmc_quad_mipi_csi2_rx_capture_pipeline_2_v_proc_ss_csc_2
{
    compatible = "xlnx,v-vpss-csc";
    reset-gpios = <&gpio 93 1>;
    ports {
        #address-cells = <1>;
        #size-cells = <0>;

        port@0 {
            reg = <0>;

            xlnx,video-format = <XVIP_VF_RBG>;
            xlnx,video-width = <8>;

            v_csc_2_in: endpoint {
                remote-endpoint = <&demosaic_2_out>;
            };
        };
        port@1 {
            reg = <1>;

            xlnx,video-format = <XVIP_VF_YUV_422>;
            xlnx,video-width = <8>;

            v_csc_2_out: endpoint {
                remote-endpoint = <&v_scaler_2_in>;
            };
        };
    };  
};
&fmc_quad_mipi_csi2_rx_capture_pipeline_3_v_proc_ss_csc_3
{
    compatible = "xlnx,v-vpss-csc";
    reset-gpios = <&gpio 94 1>;
    ports {
        #address-cells = <1>;
        #size-cells = <0>;

        port@0 {
            reg = <0>;

            xlnx,video-format = <XVIP_VF_RBG>;
            xlnx,video-width = <8>;

            v_csc_3_in: endpoint {
                remote-endpoint = <&demosaic_3_out>;
            };
        };
        port@1 {
            reg = <1>;

            xlnx,video-format = <XVIP_VF_YUV_422>;
            xlnx,video-width = <8>;

            v_csc_3_out: endpoint {
                remote-endpoint = <&v_scaler_3_in>;
            };
        };
    };  
};

&fmc_quad_mipi_csi2_rx_capture_pipeline_0_v_proc_ss_scaler_0
{
    compatible = "xlnx,v-vpss-scaler-2.2";
    reset-gpios = <&gpio 82 1>;

    ports {
        #address-cells = <1>;
        #size-cells = <0>;

        port@0 {
            reg = <0>;

            xlnx,video-format = <XVIP_VF_YUV_422>;
            xlnx,video-width = <8>;

            v_scaler_0_in: endpoint {
                remote-endpoint = <&v_csc_0_out>;
            };
        };
        port@1 {
            reg = <1>;

            xlnx,video-format = <XVIP_VF_YUV_422>;
            xlnx,video-width = <8>;

            v_scaler_0_out: endpoint {
                remote-endpoint = <&vcap_gmsl_in0>;
            };
        };
    };
};
&fmc_quad_mipi_csi2_rx_capture_pipeline_1_v_proc_ss_scaler_1
{
    compatible = "xlnx,v-vpss-scaler-2.2";
    reset-gpios = <&gpio 99 1>;

    ports {
        #address-cells = <1>;
        #size-cells = <0>;

        port@0 {
            reg = <0>;

            xlnx,video-format = <XVIP_VF_YUV_422>;
            xlnx,video-width = <8>;

            v_scaler_1_in: endpoint {
                remote-endpoint = <&v_csc_1_out>;
            };
        };
        port@1 {
            reg = <1>;

            xlnx,video-format = <XVIP_VF_YUV_422>;
            xlnx,video-width = <8>;

            v_scaler_1_out: endpoint {
                remote-endpoint = <&vcap_gmsl_in1>;
            };
        };
    };
};
&fmc_quad_mipi_csi2_rx_capture_pipeline_2_v_proc_ss_scaler_2
{
    compatible = "xlnx,v-vpss-scaler-2.2";
    reset-gpios = <&gpio 102 1>;

    ports {
        #address-cells = <1>;
        #size-cells = <0>;

        port@0 {
            reg = <0>;

            xlnx,video-format = <XVIP_VF_YUV_422>;
            xlnx,video-width = <8>;

            v_scaler_2_in: endpoint {
                remote-endpoint = <&v_csc_2_out>;
            };
        };
        port@1 {
            reg = <1>;

            xlnx,video-format = <XVIP_VF_YUV_422>;
            xlnx,video-width = <8>;

            v_scaler_2_out: endpoint {
                remote-endpoint = <&vcap_gmsl_in2>;
            };
        };
    };
};
&fmc_quad_mipi_csi2_rx_capture_pipeline_3_v_proc_ss_scaler_3
{
    compatible = "xlnx,v-vpss-scaler-2.2";
    reset-gpios = <&gpio 105 1>;

    ports {
        #address-cells = <1>;
        #size-cells = <0>;

        port@0 {
            reg = <0>;

            xlnx,video-format = <XVIP_VF_YUV_422>;
            xlnx,video-width = <8>;

            v_scaler_3_in: endpoint {
                remote-endpoint = <&v_csc_3_out>;
            };
        };
        port@1 {
            reg = <1>;

            xlnx,video-format = <XVIP_VF_YUV_422>;
            xlnx,video-width = <8>;

            v_scaler_3_out: endpoint {
                remote-endpoint = <&vcap_gmsl_in3>;
            };
        };
    };
};

&fmc_quad_mipi_csi2_rx_capture_pipeline_0_v_frmbuf_wr_0
{
    compatible = "xlnx,axi-frmbuf-wr-v2";
    xlnx,dma-align = <32>;
    reset-gpios = <&gpio 83 1>;
};
&fmc_quad_mipi_csi2_rx_capture_pipeline_1_v_frmbuf_wr_1
{
    compatible = "xlnx,axi-frmbuf-wr-v2";
    xlnx,dma-align = <32>;
    reset-gpios = <&gpio 100 1>;
};
&fmc_quad_mipi_csi2_rx_capture_pipeline_2_v_frmbuf_wr_2
{
    compatible = "xlnx,axi-frmbuf-wr-v2";
    xlnx,dma-align = <32>;
    reset-gpios = <&gpio 103 1>;
};
&fmc_quad_mipi_csi2_rx_capture_pipeline_3_v_frmbuf_wr_3
{
    compatible = "xlnx,axi-frmbuf-wr-v2";
    xlnx,dma-align = <32>;
    reset-gpios = <&gpio 106 1>;
};

/ {

    amba: amba {

        fmc_quad_mipi_csi2_axis_switch_0: axis_switch@0 {
            compatible = "xlnx,axis-switch-1.1";
            xlnx,routing-mode = <0x0>;
            xlnx,num-si-slots = <0x1>;
            xlnx,num-mi-slots = <0x4>;
            clock-names = "aclk";
            clocks = <&misc_clk_0>; 

            ports {
                #address-cells = <1>;
                #size-cells = <0>;
                port@0 {
                    reg = <0>;
                    xlnx,video-format = <XVIP_VF_MONO_SENSOR>;
                    xlnx,video-width = <8>;
                    switch_in0: endpoint {
                        remote-endpoint = <&csiss_out>;
                    };
                };
                port@1 {
                    reg = <1>;
                    xlnx,video-format = <XVIP_VF_MONO_SENSOR>;
                    xlnx,video-width = <8>;
                    switch_out0: endpoint {
                        remote-endpoint = <&demosaic_0_in>;
                    };
                };
                port@2 {
                    reg = <2>;
                    xlnx,video-format = <XVIP_VF_MONO_SENSOR>;
                    xlnx,video-width = <8>;
                    switch_out1: endpoint {
                        remote-endpoint = <&demosaic_1_in>;
                    };
                };
                port@3 {
                    reg = <3>;
                    xlnx,video-format = <XVIP_VF_MONO_SENSOR>;
                    xlnx,video-width = <8>;
                    switch_out2: endpoint {
                        remote-endpoint = <&demosaic_2_in>;
                    };
                };
                port@4 {
                    reg = <4>;
                    xlnx,video-format = <XVIP_VF_MONO_SENSOR>;
                    xlnx,video-width = <8>;
                    switch_out3: endpoint {
                        remote-endpoint = <&demosaic_3_in>;
                    };
                };
            };
        };
    };

    amba_pl: amba_pl@0 {

        vcap_gmsl {
            compatible = "xlnx,video";
            dmas = <&fmc_quad_mipi_csi2_rx_capture_pipeline_0_v_frmbuf_wr_0 0>, <&fmc_quad_mipi_csi2_rx_capture_pipeline_1_v_frmbuf_wr_1 0>, <&fmc_quad_mipi_csi2_rx_capture_pipeline_2_v_frmbuf_wr_2 0>, <&fmc_quad_mipi_csi2_rx_capture_pipeline_3_v_frmbuf_wr_3 0>;
            dma-names = "port0", "port1", "port2", "port3";

            ports {
                #address-cells = <1>;
                #size-cells = <0>;

                port@0 {
                    reg = <0>;
                    direction = "input";

                    vcap_gmsl_in0: endpoint {
                        remote-endpoint = <&v_scaler_0_out>;
                    };
                };

                port@1 {
                    reg = <1>;
                    direction = "input";

                    vcap_gmsl_in1: endpoint {
                        remote-endpoint = <&v_scaler_1_out>;
                    };
                };

                port@2 {
                    reg = <2>;
                    direction = "input";

                    vcap_gmsl_in2: endpoint {
                        remote-endpoint = <&v_scaler_2_out>;
                    };
                };

                port@3 {
                    reg = <3>;
                    direction = "input";

                    vcap_gmsl_in3: endpoint {
                        remote-endpoint = <&v_scaler_3_out>;
                    };
                };

            };
        };
    };
};

